---
title: "Методика НТ"
weight: 10
TableOfContents: true
yamlMonitoring: "perf/monitoring.json"
yamlSUT: "perf/sut.json"
yamlNFR: "perf/nfr.json"
---

# Методика НТ $name;format="Camel"$ v1.0
[[_TOC_]]

# Описание системы
[PERF-111](https://jira.tcsbank.ru/browse/PERF-111)
> Краткое описание системы.
> - Что за сервис?
> - Какие бизнес-операции выполняет?
> - Стек технологий?
> - Критичные нюансы?

# Участники проекта
> Во время подготовки к нагрузочному тестированию и его проведению, возникает большое количество вопросов связанных с обслуживанием и работой системы.
> Необходимо определить людей, ответственных за свою часть задачи, которые помогут разобраться с возникающими вопросами или провести необходимую подготовку.

| Роль | Контакты |
|----------|----------|
| Канал для связи и общения | #team-performance-ask |
| Руководитель команды | |
| Тест-Менеджер | |
| Аналитик | |
| SRE/DevOps | |
| Тестировщик | |
| Разработчик | |
| Сопровождение | |

# Цель тестирования
> Требуется указать какой цели вы хотите достичь с помощью нагрузочного тестирования.
> От этого будет зависеть набор тестовых сценариев на вашем проекте.
> Стоит учесть, что начинать тестирование стоит с самого низкого уровня, сразу начинать тесты более высоких уровней, не пройдя предыдущие, не получится.

| Уровень | Цель НТ |
|----------|----------|
| 0 | Определить характеристики отклика системы при нагрузке соответствующей продуктовому профилю. |
| 0 | Регрессионное тестирование релизов.   |
| 1 | Определить максимальную пропускную способность системы (throughput) при которой компоненты удовлетворяют предъявляемым требованиям производительности. |
| 1 | Подтвердить стабильное поведение системы под нагрузкой (отсутствие утечек RAM, скачков утилизации CPU, стабильность времён отклика) при длительной работе. |
| 2 | Воспроизведение проблем продуктивной среды (необходимо для более точной локализации проблем и проверки исправлений их). |
| 2 | Исследование поведения системы в "стрессовых" условиях. |
| 3 | Конфигурационное тестирование (подбор оптимальной конфигурации железа и/или программного обеспечения). |
| 3 | Объемное тестирование (проверка работы системы на больших объёмах данных, проверка работы системы на планируемых/будущих объёмах данных). |
| 3 | Chaos Testing и Squeeze Testing. |

# Объект тестирования
## Мониторинг контуров
<a href="#приложение-мониторинг-контуров">Мониторинг контуров</a>

[Файл с ссылками на мониторинг](monitoring.yml)

По умолчанию будут собираться все метрики производительности согласно [базовым метрикам ресурсов](https://wiki.tcsbank.ru/pages/viewpage.action?pageId=577600815) системы.

## Сравнение аппаратных характеристики тестового и продуктивного контура
<a href="#приложение-сравнение-характеристик-контуров">Сравнение характеристик контуров</a>

[Файл конфигурации](sut.yml)

## Сравнение архитектуры тестового и продуктивного контура
> Вставляется из заявки.
> Схема продуктового контура (количество нод и их характеристики, балансировщики, контейнеризация и т.п.). Желательно на схеме или в описании указать источники нагрузки для системы (пользователи, смежные системы и т.п.)
> Архитектурная схема с указанием входных точек нагрузки (либо указать под схемой).

![Alt text](docs/Azure_Bit_Gopher.png "Архитектурная схема")

## Ограничения тестирования
К тестированию по умолчанию будут применяться [базовые ограничения нагрузочного тестирования](https://wiki.tcsbank.ru/pages/viewpage.action?pageId=577598630).

> Дополнительные ограничения тестирования:
> - Не соответствует в конфигурации ОС и приложений продуктивного и тестового стенда;
> - Не соответствует аппаратная часть продуктивного и тестового стенда;
> - Используются следующие эмуляторы и/или заглушки внешних систем: ХХХ;
> - В системе присутствую критические функциональные баги номер ХХ, не закрытые на момент начала НТ;
> - Запросы/операции/сценарии которые невозможно выполнить по причине интеграционных/аппаратных/функциональных проблем;

## Нефункциональные требования производительности
> Системе не предъявлены требования производительности т.к. тестирование считается исследовательским/проводится в первый раз и не преследует прямой цели выявления дефектности систем

<a href="#приложение-требования-sla-и-nfr">Требования SLA и NFR</a>

[Файл конфигурации](nfr.yml)

# Моделирование нагрузки
## Стратегия тестирования
> Описывается основной подход к проведению НТ. Минимум пара предложений.
> В ходе НТ будет проведена серия тестов для поиска максимальной производительности. В первом тесте будет выключено логирование. Во втором и третьем будет дополнительно включен профайлер.
> Для обеспечения повторяемости результатов теста между итерациями будет производится откат изменений в БД с помощью механизмов представляемых дисковой подсистемой.

## Анализ пользовательской статистики
> Таблицы, схемы, выводы.

## Профиль нагрузки
> Таблица профиля нагрузки. При разработке профиля ориентируемся на продовый профиль по составу операций.

## Эмулируемые бизнес-сценарии
> Описание бизнес-операций. Если их много, то скрываем их в спойлер.
> <details>
> <summary>Описание бизнес-операций.</summary>
> Список операций
> </details>

# Планируемые тесты
Тест на поиск максимальной производительности. `Ступенчатое увеличение нагрузки со 100 до 160 rps с шагом 20 rps до момента полной или частичной деградации производительности системы. Удержание нагрузки на каждом шаге - 20 мин.`
<details>
<summary>Список тестов</summary>

- [ ] Тест на поиск максимальной производительности. `Ступенчатое увеличение нагрузки со 100 до 160 rps с шагом 20 rps до момента полной или частичной деградации производительности системы. Удержание нагрузки на каждом шаге - 20 мин.`
- [ ] Тест на подтверждение максимальной производительности. `Выход на нагрузку 80% от найденного максимума. Удержание нагрузки в течение 3 часов или до момента полной или частичной деградации производительности системы.`
- [ ] Воспроизведение проблем продуктивной среды. `Повторений инцидентов продуктивной среды. Профиль описывает поведение продуктива в момент инцидента.`
- [ ] Тест надёжности. `Выход на нагрузку 80% от найденного максимума. Удержание нагрузки в течение 24 часов или до момента полной или частичной деградации производительности системы.`
- [ ] Тест на определение влияния перехода на микросервисную архитектуру. `Выход на нагрузку интенсивностью 100 оп./с. Тест продолжается в течение 3 часов со стабильной интенсивностью 100 оп./с, либо до того момента когда производительность системы деградирует или времена отклика не превысят SLA.`
- [ ] Стресс тестирование. `Выход на 100% нагрузки от продуктивной нагрузки. Выключение 1 ноды через час после выхода, через 30 минут выключение 2 ноды.`
- [ ] Конфигурационное тестирование. `Сравнительное тестирование. За эталон берется тест поиска максимума с 1 конфигурацией. В данном тестировании профиль будет повторен, но при этом будет использоваться 2 конфигурация. Ступенчатое увеличение нагрузки со 100 до 160 rps с шагом 20 rps до момента полной или частичной деградации производительности системы. Удержание нагрузки на каждом шаге - 20 мин.`
- [ ] Объемное тестирование. `Выход на нагрузку 80% от найденного максимума и удержание её в течении 5 часов. Через 30 минут после выхода на нагрузку начинается загрузка объёмных реестров/файлов в систему. Ступенчатое увеличение нагрузки со 100 до 160 rps с шагом 20 rps до момента полной или частичной деградации производительности системы. При этом БД заранее содержит данные планируемых объёмов. Удержание нагрузки на каждом шаге - 20 мин.`
- [ ] Chaos Testing.
- [ ] Squeeze Testing.

</details>

# Подготовка тестовых данных
> Для проведения НТ будет создано 100500 пользователей в системе с правами тестировщик.
> Здесь же расписываем как будет происходить наполнение БД с помощью специально разработанных скриптов. В ходе НТ будут наполнены следующие таблицы, следующим образом.

# Эмуляторы и заглушки
> В блоке эмуляторов и заглушек необходимо указывать ссылку в гит и на информацию о заглушке
> Часть систем, участвующих в процессе работы системы будут заменены эмуляторами/заглушками. Ниже приведен список эмуляторов:

| Эмулятор | Операция | Протокол | Время отклика | Эмулируемая функция |
|----------|----------|----------|----------|----------|
| POS | 100 | ISO 8583  | 3 сек. | Авторизация |

> Эмулировать работу системы ХХ не требуется, достаточно удалять данные с диска каждые 5 секунд.
> В качестве упрощения на все запросы от системы УУ будет отправляться успешный ответ.

# Приложения
> Вставляется из заявки.
> 1. Ссылки на доступные wiki и прочие ресурсы.
> 0. Ссылка на git со скриптами НТ и т.п
